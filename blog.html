<!DOCTYPE html>
<html lang="pt-br">
<head>
      <link rel="icon" type="image/png" href="/favicon-transparente.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog | Virlene Figueiredo</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;family=Playfair+Display:wght@700&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --cor-principal: #57643a;
      --cor-texto: #423d38;
      --cor-fundo: #fcfaf7;
    }
    /* --- Inline, cards em linha --- */
    body { background: var(--cor-fundo); margin: 0; font-family: 'Roboto', Arial, sans-serif; color: var(--cor-texto); }
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--cor-principal);
      color: #fff;
      padding: 0.8rem 3vw;
      height: 96px;
      min-height: 72px;
      box-shadow: 0 2px 16px #0003;
      z-index: 1000;
    }
    .navbar-logo-central {
      height: 100%;
      display: flex;
      align-items: center;
      padding-top: 24px;
    }
    .navbar-logo-central img {
      height: 220px;
      width: auto;
      max-width: 325px;
      object-fit: contain;
      display: block;
      margin-right: 12px;
    }
    .navbar-menu {
      display: flex;
      gap: 1.4rem;
      list-style: none;
      margin: 0;
      padding: 0;
      align-items: center;
    }
    .navbar-menu a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: color 0.18s;
    }
    .navbar-menu a:hover {
      color: #ffd970;
    }
    .navbar-toggle {
      display: none;
      background: none;
      border: none;
      color: #fff;
      font-size: 2.2rem;
      cursor: pointer;
      margin-left: auto;
    }
    @media (max-width: 1050px) {
      .navbar-menu {
        position: fixed;
        top: 120px;
        right: 0;
        width: min(84vw, 420px);
        max-height: calc(100vh - 120px);
        background: var(--cor-principal);
        flex-direction: column;
        align-items: flex-start;
        gap: 1.6rem;
        padding: 2.4rem 2rem;
        box-sizing: border-box;
        box-shadow: -3px 0 24px #0003;
        transform: translateX(110%);
        transition: transform 0.28s;
        z-index: 999;
        overflow-y: auto;
      }
      .navbar-menu.open {
        transform: translateX(0%);
      }
      .navbar-toggle {
        display: block;
        font-size: 2.6rem;
      }
      .navbar-menu a {
        font-size: 1.2rem;
        line-height: 1.6;
        padding: 0.6rem 0;
        width: 100%;
        font-weight: 700;
      }
    }
    .banner-blog-card {
      max-width: 660px;
      margin: 38px auto 32px auto;
      background: linear-gradient(90deg, #6A5036 0%, #44331E 100%);
      color: #fff;
      font-family: 'Playfair Display', serif;
      font-size: 2.1rem; font-weight: 700; letter-spacing: 0.01em;
      border-radius: 19px; padding: 31px 0 21px 46px;
      box-shadow: 0 5px 38px rgba(106,80,54,0.10);
      border-left: 6px solid #e4c7a6;
      display: flex; align-items: center; justify-content: flex-start;
    }
    .blog-container { max-width: 1200px; margin: 30px auto 70px auto; display: flex; flex-direction: column; gap: 48px; padding: 0 2vw; }
    .blog-hero {
      position: relative;
      border-radius: 28px;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(48,121,91,0.92), rgba(106,80,54,0.92)), url('img/espaco3.png') center/cover no-repeat;
      color: #fff;
      min-height: 260px;
      display: flex;
      align-items: center;
    }
    .blog-hero__content { padding: 48px clamp(24px, 5vw, 64px); max-width: 600px; }
    .blog-hero__title {
      margin: 0 0 12px 0;
      font-family: 'Playfair Display', serif;
      font-size: clamp(2rem, 4vw, 3rem);
      letter-spacing: 0.02em;
    }
    .blog-hero__subtitle {
      margin: 0;
      font-size: clamp(1rem, 2vw, 1.2rem);
      line-height: 1.7;
      color: rgba(255,255,255,0.85);
    }
    .blog-content { display: flex; gap: 44px; align-items: flex-start; }
    .posts-main { flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 32px; }
    .post-card {
      position: relative;
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 18px 40px rgba(26, 33, 24, 0.08);
      overflow: hidden;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      width: 100%;
    }
    .post-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 24px 45px rgba(26, 33, 24, 0.12);
    }
    .post-media { position: relative; }
    .post-img {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      display: block;
    }
    .post-badge {
      position: absolute;
      top: 18px;
      left: 18px;
      background: rgba(48,121,91,0.9);
      color: #fff;
      font-size: 0.85rem;
      font-weight: 700;
      padding: 6px 14px;
      border-radius: 999px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .post-body {
      padding: 26px 28px 24px 28px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .post-title {
      color: #2b4a3d;
      font-family: 'Playfair Display', serif;
      font-size: 1.32rem;
      font-weight: 700;
      text-decoration: none;
      line-height: 1.3;
    }
    .post-title:hover { color: #3f8164; }
    .post-meta {
      font-size: 0.93rem;
      color: #6a9080;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    .post-desc {
      color: #4b4238;
      font-size: 1rem;
      line-height: 1.6;
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .post-actions {
      margin-top: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .btn-continuar {
      background: linear-gradient(135deg, #e06350, #f28b6b);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 22px;
      font-size: 0.98rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-continuar:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(224, 99, 80, 0.3);
    }
    .btn-edit-admin,
    .btn-toggle-admin {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .btn-edit-admin { background: #2f2f2f; color: #fff; }
    .btn-toggle-admin { background: #ae3829; color: #fff; }
    .btn-edit-admin:hover,
    .btn-toggle-admin:hover { opacity: 0.85; }
    .sidebar { background: #fff; border-radius: 26px; padding: 32px 28px; box-shadow: 0 22px 40px rgba(26,33,24,0.08); width: 320px; max-width: 94vw; height: fit-content; position: sticky; top: 120px; display: flex; flex-direction: column; gap: 22px; }
    @media (max-width: 1100px) {
      .blog-content { flex-direction: column; align-items: stretch; }
      .sidebar { width: 100%; position: static; top: auto; margin: 0; order: -1; }
      .posts-main { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 28px; width: 100%; margin-right: 0; }
      .post-card { margin-right: 0; }
    }
    .search-bar { display: flex; gap: 8px; }
    .search-input { flex: 1; border: 1.2px solid rgba(48,121,91,0.3); border-radius: 999px; padding: 10px 18px; font-size: 1rem; background: #f8fbf7; }
    .search-btn { background: linear-gradient(135deg, #30795b, #4ba384); color: #fff; border: none; border-radius: 999px; padding: 10px 20px; font-size: 1rem; cursor: pointer; font-weight: 600; box-shadow: 0 12px 20px rgba(48,121,91,0.25); transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .search-btn:hover { transform: translateY(-2px); box-shadow: 0 18px 28px rgba(48,121,91,0.28); }
    .sidebar-titulo { color: #6a9080; font-size: 1.09rem; font-weight: 700; margin: 13px 0 9px 0; font-family: 'Roboto', sans-serif;}
    .cat-list { list-style: none; padding: 0; margin: 0 0 13px 0;}
    .cat-list li { margin-bottom: 6px;}
    .cat-link { color: #30795b; text-decoration: none; font-size: 1.01rem;}
    .cat-link:hover { text-decoration: underline;}
    /* Detalhe SPA */
    #detalhe-post {
      display: none;
      max-width: 1040px;
      margin: 40px auto 90px auto;
      padding: 0 2vw;
    }
    .detalhe-content {
      background: #fff;
      border-radius: 32px;
      box-shadow: 0 32px 60px rgba(26, 33, 24, 0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .detalhe-header {
      background: linear-gradient(135deg, rgba(48,121,91,0.95), rgba(106,80,54,0.9));
      padding: clamp(32px, 5vw, 56px) clamp(28px, 6vw, 72px) clamp(24px, 4vw, 48px);
      color: #fff;
    }
    .detalhe-cat {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 999px;
      padding: 6px 18px;
      font-size: 0.8rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 18px;
    }
    #detalhe-titulo {
      margin: 0;
      font-family: 'Playfair Display', serif;
      font-size: clamp(2rem, 4.2vw, 3.3rem);
      line-height: 1.2;
    }
    .detalhe-media {
      background: #f3f5ef;
    }
    #detalhe-img {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      display: block;
    }
    .detalhe-body {
      padding: clamp(28px, 6vw, 60px) clamp(28px, 6vw, 72px) clamp(36px, 6vw, 72px);
      color: #3d3934;
      font-size: 1.1rem;
      line-height: 1.8;
    }
    .detalhe-body p { margin-bottom: 1.4em; }
    .detalhe-body h2,
    .detalhe-body h3 {
      font-family: 'Playfair Display', serif;
      color: #2b4a3d;
      margin-top: 1.6em;
    }
    .btn-voltar {
      background: #fff;
      border: 2px solid #57643a;
      color: #57643a;
      border-radius: 999px;
      padding: 10px 26px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
      margin: 0 clamp(28px, 6vw, 72px) 24px clamp(28px, 6vw, 72px);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    .btn-voltar:hover {
      background: #57643a;
      color: #fff;
      box-shadow: 0 12px 22px rgba(87,100,58,0.25);
    }
    @media (max-width: 700px) {
      .blog-hero { min-height: 220px; }
      .detalhe-body { font-size: 1.02rem; line-height: 1.7; }
      #detalhe-post { margin: 32px auto 70px auto; }
      .btn-voltar { width: 100%; text-align: center; justify-content: center; }
    }

    @media (max-width: 600px) {
      .post-body { padding: 22px 22px 24px 22px; }
      .post-title { font-size: 1.18rem; }
      .post-badge { top: 14px; left: 14px; font-size: 0.75rem; }
      .posts-main { gap: 24px; }
    }

  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-logo-central">
      <img src="img/logo.png" alt="Consultório de Terapia Corporal Sistêmica" />
    </div>
    <button class="navbar-toggle" aria-label="Abrir menu">&#9776;</button>
    <ul class="navbar-menu">
      <li><a href="index.html">Home</a></li>
      <li><a href="espaco.html">O Espaço</a></li>
      <li><a href="servicos.html">Serviços</a></li>
      <li><a href="blog.html">Blog</a></li>
      <li><a href="contato.html">Contato</a></li>
      <li id="li-perfil-login"><a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a></li>
    </ul>
  </nav>
  <div class="banner-blog-card">Blog</div>
  <div class="blog-container">
    <section class="blog-hero">
      <div class="blog-hero__content">
        <h1 class="blog-hero__title">Inspirações para uma vida mais leve</h1>
        <p class="blog-hero__subtitle">Explore reflexões, práticas e histórias para cultivar equilíbrio corpo-mente em sua jornada de autoconhecimento.</p>
      </div>
    </section>
    <div class="blog-content">
      <main class="posts-main" id="posts-main">
        <!-- Cards serão renderizados aqui -->
      </main>
      <aside class="sidebar">
        <form class="search-bar" onsubmit="buscarBlog(event)">
          <input type="text" class="search-input" id="blog-search" placeholder="O que você procura?">
          <button class="search-btn" type="submit">Buscar</button>
        </form>
        <div class="sidebar-titulo">CATEGORIAS</div>
        <ul class="cat-list" id="cat-list">
          <!-- Categorias renderizadas via JS -->
        </ul>
      </aside>
    </div>
  </div>
  <!-- Página Detalhada -->
  <div id="detalhe-post">
    <button class="btn-voltar" onclick="voltarParaBlog()">&larr; Voltar ao Blog</button>
    <article class="detalhe-content">
      <header class="detalhe-header">
        <span id="detalhe-cat" class="detalhe-cat">Categoria</span>
        <h1 id="detalhe-titulo">Título do Post</h1>
      </header>
      <figure class="detalhe-media">
        <img id="detalhe-img" src="" alt="" onerror="this.onerror=null;this.src='iconeFinal.png';" />
      </figure>
      <div id="detalhe-body" class="detalhe-body">Conteúdo detalhado aqui...</div>
    </article>
  </div>
  <script>
    let postsBlog = [];
    let allCategories = [];
    let isAdmin = false;
    const navbarToggle = document.querySelector('.navbar-toggle');
    const navbarMenu = document.querySelector('.navbar-menu');
    if (navbarToggle && navbarMenu) {
      navbarToggle.addEventListener('click', () => {
        navbarMenu.classList.toggle('open');
      });
      document.querySelectorAll('.navbar-menu a').forEach(link => {
        link.addEventListener('click', () => {
          navbarMenu.classList.remove('open');
        });
      });
    }
    // Busca dados do blog do backend
    fetch('getPostsBlog.php')
      .then(res => res.json())
      .then(data => {
        postsBlog = data.posts;
        allCategories = [...new Set(postsBlog.map(p => p.categoria))];
        renderPosts(postsBlog);
        renderCategories(allCategories);
      });

    // Checa se usuário logado é admin (para mostrar botões especiais)
    fetch('getPerfil.php', { credentials: 'include' })
      .then(res => res.ok ? res.json() : Promise.reject())
      .then(data => {
        if (data.usuario && data.usuario.is_admin == 1) isAdmin = true;
        if (data.usuario && data.usuario.nome) {
          document.getElementById('li-perfil-login').innerHTML =
            '<a href="perfil.html"><i class="fa-solid fa-user"></i> Perfil</a>';
        } else {
          document.getElementById('li-perfil-login').innerHTML =
            '<a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a>';
        }
      }).catch(() => {
        document.getElementById('li-perfil-login').innerHTML =
          '<a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a>';
      });

    function renderPosts(lista) {
      const main = document.getElementById('posts-main');
      main.innerHTML = '';
      if (!lista.length) {
        main.innerHTML = '<p style="margin:46px 0; color:#a0522d; font-size:1.16rem;">Nenhum post encontrado.</p>';
        return;
      }
      lista.forEach((post, idx) => {
        main.innerHTML += `
        <article class="post-card">
          <figure class="post-media">
            <img src="${post.imagem}" class="post-img" alt="${post.titulo}" onerror="this.onerror=null;this.src='iconeFinal.png';" />
            <figcaption class="post-badge">${post.categoria}</figcaption>
          </figure>
          <div class="post-body">
            <span class="post-meta">Categoria • ${post.categoria}</span>
            <a href="#" class="post-title" data-idx="${idx}">${post.titulo}</a>
            <p class="post-desc">${post.desc}</p>
            <div class="post-actions">
              <button class="btn-continuar" data-idx="${idx}">Continue Lendo</button>
              ${isAdmin ? `
              <button class="btn-edit-admin" onclick="window.location.href='admin/blog.php?edit=${post.id}#editar-publicacao'">Editar</button>
              <button class="btn-toggle-admin" onclick="togglePost(${post.id})">${post.publicado ? 'Arquivar' : 'Publicar'}</button>` : ''}
            </div>
          </div>
        </article>`;
      });
      addPostsEvent(lista);
    }

    function addPostsEvent(lista) {
      document.querySelectorAll('.btn-continuar, .post-title').forEach(btn => {
        btn.onclick = function(e) {
          e.preventDefault();
          const idx = +btn.getAttribute('data-idx');
          mostrarDetalhe(idx, lista);
        };
      });
    }

    function mostrarDetalhe(idx, lista) {
      document.querySelector('.blog-container').style.display = 'none';
      const post = (lista || postsBlog)[idx];
      document.getElementById('detalhe-titulo').innerText = post.titulo;
      document.getElementById('detalhe-cat').innerText = post.categoria || 'Blog';
      document.getElementById('detalhe-img').src = post.imagem;
      document.getElementById('detalhe-img').alt = post.titulo;
      document.getElementById('detalhe-body').innerHTML = post.conteudo;
      document.getElementById('detalhe-post').style.display = 'block';
      window.scrollTo({top:0});
    }

    function voltarParaBlog() {
      document.getElementById('detalhe-post').style.display = 'none';
      document.querySelector('.blog-container').style.display = 'flex';
      window.scrollTo({top:0});
    }

    function renderCategories(cats) {
      const catList = document.getElementById('cat-list');
      catList.innerHTML = '';
      cats.forEach(cat => {
        catList.innerHTML += `<li><a href="#" class="cat-link" onclick="filtrarCategoria('${cat}')">${cat}</a></li>`;
      });
    }

    function filtrarCategoria(cat) {
      renderPosts(postsBlog.filter(p => p.categoria === cat));
    }

    function buscarBlog(e) {
      e.preventDefault();
      const termo = document.getElementById('blog-search').value.trim().toLowerCase();
      if (!termo) {
        renderPosts(postsBlog);
        return;
      }
      renderPosts(postsBlog.filter(p => (
        p.titulo.toLowerCase().includes(termo) ||
        p.desc.toLowerCase().includes(termo) ||
        p.categoria.toLowerCase().includes(termo) ||
        (p.conteudo && p.conteudo.toLowerCase().includes(termo))
      )));
    }

    // Admin: Publicar/Arquivar post sem recarregar página
    function togglePost(postId) {
      if (!confirm('Tem certeza que deseja alterar o status deste post?')) return;
      fetch('admin/blog.php', {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: 'toggle_id=' + encodeURIComponent(postId)
      })
      .then(res => res.text())
      .then(() => location.reload());
    }
  </script>
</body>
</html>
