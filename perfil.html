<!DOCTYPE html>
<html lang="pt-br">
<head>
      <link rel="icon" type="image/png" href="/favicon-transparente.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Perfil | Consultório de Terapia Corporal Sistêmica</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --cor-principal: #57643a;
      --cor-destaque: #f7e6bc;
      --cor-fundo: #fcfaf7;
      --cor-box: #fff;
      --cor-btn: #6A5036;
      --cor-btn-hover: #8b6f4e;
      --cor-status-pendente: #c79b2c;
      --cor-status-confirmada: #44a24b;
      --cor-status-cancelada: #d95e4b;
      --cor-anamnese: #a04eb7;
    }
    body {
      background: var(--cor-fundo);
      margin: 0;
      font-family: 'Roboto', Arial, sans-serif;
      color: #222;
      font-size: 1.08rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .page-wrapper {
      flex: 1 0 auto;
      display: flex;
      flex-direction: column;
    }
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--cor-principal);
      color: #fff;
      padding: 0.8rem 3vw;
      height: 96px;
      min-height: 72px;
      box-shadow: 0 2px 16px #0003;
      z-index: 1000;
    }
    .navbar-logo-central {
      height: 100%;
      display: flex;
      align-items: center;
      padding-top: 24px;
    }
    .navbar-logo-central img {
      height: 220px;
      width: auto;
      max-width: 325px;
      object-fit: contain;
      display: block;
      margin-right: 12px;
    }

    .navbar-menu {
      display: flex;
      gap: 1.4rem;
      list-style: none;
      margin: 0;
      padding: 0;
      align-items: center;
    }

    .navbar-menu a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: color 0.18s;
    }
    .navbar-menu a:hover {
      color: #ffd970;
    }

    .navbar-toggle {
      display: none;
      background: none;
      border: none;
      color: #fff;
      font-size: 2.2rem;
      cursor: pointer;
      margin-left: auto;
    }

    @media (max-width: 1050px) {
      .navbar-menu {
        position: fixed;
        top: 120px;
        right: 0;
        width: min(84vw, 420px);
        height: 100vh;
        background: var(--cor-principal);
        flex-direction: column;
        align-items: flex-start;
        gap: 1.6rem;
        padding: 2.4rem 2rem;
        box-sizing: border-box;
        box-shadow: -3px 0 24px #0003;
        transform: translateX(110%);
        transition: transform 0.28s;
        z-index: 999;
      }
      .navbar-menu.open {
        transform: translateX(0%);
      }
      .navbar-toggle {
        display: block;
        font-size: 2.6rem;
      }
      .navbar-menu a {
        font-size: 1.2rem;
        line-height: 1.6;
        padding: 0.6rem 0;
        width: 100%;
        font-weight: 700;
      }
    }
    .banner-terra {
    max-width: 660px;
    margin: 38px auto 32px auto;
    background: linear-gradient(90deg, #6A5036 0%, #44331E 100%);
    color: #fff;
    font-family: 'Playfair Display', serif;
    font-size: 2.1rem;
    font-weight: 700;
    letter-spacing: 0.01em;
    border-radius: 19px;
    padding: 31px 0 21px 46px;
    box-shadow: 0 5px 38px rgba(106,80,54,0.10);
    border-left: 6px solid #e4c7a6;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    text-align: left;
    }
    @media (max-width: 800px) {
    .banner-terra { font-size: 1.22rem; padding: 18px 0 13px 18px; }
    }

    .perfil-container {
      max-width: 740px;
      background: var(--cor-box);
      margin: 34px auto 48px auto;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(106,80,54,0.09);
      padding: 36px 3vw 32px 3vw;
    }
    .alerta-completar {
      max-width: 740px;
      margin: 24px auto 0 auto;
      background: #ffe3c4;
      border: 1px solid #f0b26b;
      border-radius: 12px;
      padding: 18px 22px;
      color: #6a3d1f;
      font-size: 1.05rem;
      box-shadow: 0 3px 16px rgba(106,80,54,0.08);
    }
    .perfil-info {
      display: flex;
      gap: 28px;
      align-items: center;
      margin-bottom: 36px;
      flex-wrap: wrap;
    }
    .perfil-avatar {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      object-fit: cover;
      background: #e4f1e6;
      box-shadow: 0 2px 18px rgba(48,121,91,0.12);
    }
    .perfil-dados {
      flex: 1;
      min-width: 240px;
    }
    .perfil-nome {
      font-size: 1.36rem;
      font-weight: 700;
      color: var(--cor-principal);
      font-family: 'Playfair Display', serif;
    }
    .perfil-email { color: #444; margin-top: 5px; margin-bottom: 7px; }
    .perfil-editar {
      padding: 5px 11px;
      font-size: 1rem;
      border-radius: 50%;
      width: 44px; height: 44px;
      justify-content: center;
      align-items: center;
      display: flex;
    }
    .status-sessoes {
      margin-bottom: 28px;
      padding: 16px 18px;
      background: #f9f6f1;
      border-radius: 13px;
      box-shadow: 0 2px 12px rgba(106,80,54,0.06);
      color: #423d38;
    }
    .sessoes-lista {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 17px;
    }
    .sessao-card {
      background: #f8f6f2;
      border-radius: 13px;
      box-shadow: 0 1px 6px rgba(106,80,54,0.07);
      padding: 17px 18px 13px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      border-left: 5px solid #e4c7a6;
      transition: box-shadow .13s;
      position: relative;
    }
    .sessao-card:hover {
      box-shadow: 0 5px 18px rgba(48,121,91,0.12);
    }
    .sessao-info {
      flex: 1;
    }
    .sessao-tratamento {
      font-size: 1.11rem;
      color: var(--cor-btn);
      font-weight: 700;
      font-family: 'Playfair Display', serif;
    }
    .sessao-data {
      font-size: 0.99rem;
      color: #4e4360;
      margin-bottom: 3px;
    }
    .sessao-status {
      font-size: 0.97rem;
      font-weight: bold;
      border-radius: 6px;
      padding: 3px 13px;
      display: inline-block;
      margin-top: 4px;
    }
    .sessao-anamnese {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .status-pendente {
      background: #fcf3d4;
      color: var(--cor-status-pendente);
      border: 1.2px solid #e3ce95;
    }
    .status-confirmada {
      background: #e0f6e3;
      color: var(--cor-status-confirmada);
      border: 1.2px solid #74d295;
    }
    .status-cancelada {
      background: #ffe7e1;
      color: var(--cor-status-cancelada);
      border: 1.2px solid #efbfb5;
    }
    .icon-anamnese {
      font-size: 1.43rem;
      color: var(--cor-anamnese);
      margin-left: 9px;
      vertical-align: -2px;
    }
    .anamnese-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      position: relative;
      border-radius: 999px;
      padding: 5px 26px 6px 12px;
      font-size: 0.92rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      border: none;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, opacity 0.18s ease;
      background: linear-gradient(135deg, rgba(160, 78, 183, 0.92) 0%, rgba(94, 49, 152, 0.9) 100%);
      color: #fff;
      box-shadow: 0 8px 24px rgba(160, 78, 183, 0.28);
    }
    .anamnese-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 32px rgba(94, 49, 152, 0.25);
    }
    .anamnese-pill:focus {
      outline: 2px solid rgba(160, 78, 183, 0.35);
      outline-offset: 3px;
    }
    .anamnese-badge {
      position: absolute;
      top: -6px;
      right: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #6ec6ff;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(110, 198, 255, 0.45);
      pointer-events: none;
    }
    .anamnese-pill > span {
      position: relative;
      z-index: 1;
    }
    .anamnese-pill.indisponivel {
      cursor: default;
      background: linear-gradient(135deg, rgba(140, 140, 140, 0.15) 0%, rgba(120, 120, 120, 0.25) 100%);
      color: #575757;
      box-shadow: inset 0 0 0 1px rgba(120, 120, 120, 0.2);
    }
    .anamnese-pill.indisponivel:hover {
      transform: none;
      box-shadow: inset 0 0 0 1px rgba(120, 120, 120, 0.2);
    }
    .historico-title {
      font-size: 1.15rem;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      color: var(--cor-principal);
      margin: 37px 0 10px 0;
    }
    .nenhuma-sessao {
      color: #bca870;
      font-size: 1.08rem;
      margin-top: 15px;
    }
    /* Página Detalhe da Sessão */
    #detalhe-sessao {
      display: none;
      max-width: 700px;
      margin: 38px auto 60px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 32px rgba(106,80,54,0.09);
      padding: 46px 6vw 40px 6vw;
    }
    #detalhe-titulo {
      color: var(--cor-btn);
      font-family:'Playfair Display',serif;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      margin: 0 0 19px 0;
    }
    #detalhe-formulario, #detalhe-anamnese {
      background: #fcfaf7;
      border-radius: 13px;
      box-shadow: 0 0px 0px 1.5px #f2f0ea;
      padding: 18px 15px 14px 15px;
      margin-bottom: 21px;
    }
    #detalhe-formulario label, #detalhe-anamnese label {
      font-weight: 700;
      color: #30795b;
      font-size: 1.06rem;
    }
    #detalhe-formulario .valor, #detalhe-anamnese .valor {
      color: #423d38;
      font-size: 1.04rem;
      margin-bottom: 9px;
      display: block;
    }
    .btn-voltar {
      background: #ede6c6;
      color: #6A5036;
      border: none;
      border-radius: 7px;
      padding: 10px 27px;
      font-size: 1.09rem;
      font-weight: 700;
      cursor: pointer;
      float: right;
      margin-left: 15px;
    }
    .btn-voltar:hover {
      background: #e2d6b8;
    }
    .footer {
      text-align: center;
      background: var(--cor-principal);
      color: #fff;
      padding: 1.2rem;
      font-size: 1rem;
      letter-spacing: 0.05em;
      margin-top: 44px;
    }
    @media (max-width: 900px) {
      .perfil-container, #detalhe-sessao { max-width: 98vw; padding: 14px 2vw 18px 2vw; }
      .perfil-avatar { width: 80px; height: 80px; }
    }
    .botao-upload {
      display: block;
      background-color: #ede6c6;
      color: #6A5036;
      margin: 12px auto 0 auto;
      padding: 0.5rem 1.1rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      cursor: pointer;
      transition: background 0.18s;
    }
    .botao-upload:hover {
      background: #e3ce95;
    }
    #modal-anamnese {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(26, 18, 34, 0.48);
      backdrop-filter: blur(6px);
      z-index: 10000;
      padding: 24px;
    }
    #modal-anamnese.aberto {
      display: flex;
    }
    .modal-anamnese-container {
      background: linear-gradient(165deg, #ffffff 0%, #f4effb 100%);
      border-radius: 18px;
      width: min(540px, 92vw);
      max-height: min(84vh, 640px);
      overflow: hidden;
      box-shadow: 0 24px 60px rgba(62, 40, 102, 0.28);
      border: 1px solid rgba(160, 78, 183, 0.15);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .modal-anamnese-header {
      padding: 20px 28px 12px;
      background: linear-gradient(135deg, rgba(160, 78, 183, 0.18) 0%, rgba(94, 49, 152, 0.22) 100%);
      color: var(--cor-btn);
      font-family: 'Playfair Display', serif;
      font-size: 1.35rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    .modal-anamnese-close {
      background: rgba(255, 255, 255, 0.82);
      border: none;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(160, 78, 183, 0.22);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      color: #5d3492;
      font-size: 1.1rem;
    }
    .modal-anamnese-close:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 22px rgba(94, 49, 152, 0.25);
    }
    .modal-anamnese-content {
      padding: 16px 28px 28px;
      overflow-y: auto;
      color: #403648;
      line-height: 1.55;
      font-size: 1.02rem;
    }
    .modal-anamnese-content p {
      margin: 0 0 12px;
      white-space: pre-line;
    }
    .modal-anamnese-content pre {
      background: rgba(255, 255, 255, 0.75);
      border-radius: 12px;
      padding: 14px 16px;
      margin: 0 0 12px;
      overflow-x: auto;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.88rem;
      line-height: 1.45;
      color: #3f2f58;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.65);
    }
    .modal-anamnese-content .campo-anamnese {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), 0 4px 12px rgba(94, 49, 152, 0.08);
    }
    .modal-anamnese-content .campo-anamnese strong {
      display: block;
      color: #5d3492;
      margin-bottom: 6px;
      font-weight: 700;
    }
    .modal-anamnese-content .campo-anamnese span {
      display: block;
      white-space: pre-line;
    }
    .modal-anamnese-empty {
      text-align: center;
      color: #6a6180;
      font-style: italic;
    }
    @media (max-width: 520px) {
      .modal-anamnese-header {
        padding: 16px 20px 10px;
        font-size: 1.18rem;
      }
      .modal-anamnese-content {
        padding: 12px 20px 22px;
      }
      .modal-anamnese-close {
        width: 34px;
        height: 34px;
      }
    }
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.4);
      display: flex;  /* O padrão é sumido */
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      max-width: 420px;
      width: 92vw;
      box-shadow: 0 0 30px #0004;
    }
    .avatar-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
    }
    .perfil-editar, .perfil-logout {
      margin-right: 12px;
      margin-top: 14px;
    }
    @media (max-width: 700px) {
      .perfil-editar, .perfil-logout {
        display: block;
        margin: 10px 0 0 0;
        width: 100%;
      }
    }
    #modal-editar { display: none; }
    .perfil-nome { font-size: 1.45rem; font-weight: 700; color: var(--cor-principal); font-family: 'Playfair Display', serif;}
    .perfil-email { color: #444; margin: 6px 0 7px 0; font-size: 1.12rem;}
    #perfil-idade { color: #706c66; font-size: 1.05rem; margin-bottom: 5px;}
    .perfil-dados { display: flex; flex-direction: column; gap: 2px; }
    .perfil-acoes {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }
    .perfil-editar, .perfil-logout {
      background: #f6f2e3;
      color: var(--cor-principal);
      border: none;
      border-radius: 7px;
      padding: 7px 13px;
      font-size: 1.23rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.19s;
      box-shadow: 0 1px 4px #bbb1;
    }
    .perfil-editar:hover, .perfil-logout:hover {
      background: #f7e6bc;
      color: #634d25;
    }
    @media (max-width: 700px) {
      .perfil-acoes { gap: 7px; }
      .perfil-editar, .perfil-logout { width: 44px; height: 44px; padding: 0; font-size: 1.12rem; }
    }
    .perfil-upload-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin: 10px 0 0 0;
    }
  </style>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="page-wrapper">
  <nav class="navbar">
    <div class="navbar-logo-central">
      <img src="img/logo.png" alt="Consultório de Terapia Corporal Sistêmica" />
    </div>
    <button class="navbar-toggle" aria-label="Abrir menu">&#9776;</button>
    <ul class="navbar-menu">
      <li><a href="index.html">Home</a></li>
      <li><a href="espaco.html">O Espaço</a></li>
      <li><a href="servicos.html">Serviços</a></li>
      <li><a href="blog.html">Blog</a></li>
      <li><a href="contato.html">Contato</a></li>
      <li id="li-perfil-login"><a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a></li>
      <li><a href="registrar.html" onclick="logout()">Sair</a></li>
    </ul>
  </nav>
  <div class="banner-terra">Meu Perfil</div>

  <div class="perfil-container" id="perfil-area">
    <div id="alerta-completar" class="alerta-completar" style="display:none;">
      Para continuar utilizando todos os serviços, informe seu telefone, data de nascimento e sexo.
    </div>
    <div class="perfil-info">
      <div class="avatar-area">
        <img src="img/avatar-user.jpg" class="perfil-avatar" alt="Usuário">
        <label for="upload-foto" class="botao-upload">Carregar imagem</label>
        <input type="file" id="upload-foto" accept="image/*" style="display: none;">
        <label for="upload-foto-camera" class="botao-upload">Tirar foto</label>
        <input type="file" id="upload-foto-camera" accept="image/*" capture="environment" style="display: none;">

      </div>
      <div class="perfil-dados">
        <p class="perfil-nome" id="perfil-nome">--</p>
        <p class="perfil-email" id="perfil-email">--</p>
        <p id="perfil-idade" style="display: none !important;">--</p>

        <div class="perfil-acoes">
          <button class="perfil-editar" title="Editar dados">
            <i class="fa-regular fa-pen-to-square"></i>
          </button>
          <button class="perfil-logout" onclick="logout()" title="Encerrar sessão">
            <i class="fa-solid fa-right-from-bracket"></i>
          </button>
        </div>

      </div>
    </div>
    <div id="pacote-info" style="margin-bottom:22px;font-size:1.14rem;color:#7a650f;"></div>
    <div class="status-sessoes" id="status-sessoes">
      <b>Sessão Agendada:</b><br>
      <div class="sessoes-lista" id="proximas-sessoes"></div>
    </div>
    <div class="historico-title">Histórico de Consultas</div>
    <div class="sessoes-lista" id="historico-sessoes"></div>
  </div>

  <!-- Modal Editar Perfil -->
  <div id="modal-editar" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3>Editar Perfil</h3>
      <label>
        Nome:
        <input type="text" id="editar-nome">
      </label><br>
      <label>
        Email:
        <input type="email" id="editar-email">
      </label><br>
      <label>
        Data de nascimento:
        <input type="date" id="editar-nascimento">
      </label><br>
      <label>
        Telefone:
        <input type="text" id="editar-telefone">
      </label><br>
      <label>
        Sexo:
        <select id="editar-sexo">
          <option value="">Não informar</option>
          <option value="Feminino">Feminino</option>
          <option value="Masculino">Masculino</option>
          <option value="Outro">Outro</option>
        </select>
      </label><br>
      <button onclick="salvarEdicao()">Salvar</button>
      <button id="btn-cancelar-editar" onclick="fecharModal()">Cancelar</button>
    </div>
  </div>
  <div id="feedback-msg" style="display:none;position:fixed;top:12px;left:50%;transform:translateX(-50%);background:#88c275;padding:13px 29px;font-size:1.2rem;color:#fff;border-radius:9px;z-index:99999;box-shadow:0 2px 22px #2224;"></div>


  <!-- Detalhe da sessão (abre como SPA) -->
  <div id="detalhe-sessao">
    <button class="btn-voltar" onclick="voltarParaPerfil()">&larr; Voltar ao Perfil</button>
    <h1 id="detalhe-titulo">Detalhes da Sessão</h1>
    <div id="detalhe-formulario"></div>
    <div id="detalhe-anamnese"></div>
  </div>

  <div id="modal-anamnese" role="dialog" aria-modal="true" aria-labelledby="modal-anamnese-titulo">
    <div class="modal-anamnese-container">
      <div class="modal-anamnese-header">
        <span id="modal-anamnese-titulo">Anamnese da sessão</span>
        <button type="button" class="modal-anamnese-close" aria-label="Fechar anamnese" onclick="fecharModalAnamnese()">&times;</button>
      </div>
      <div id="modal-anamnese-conteudo" class="modal-anamnese-content"></div>
    </div>
  </div>
  </div>
  <footer class="footer">
    <p>Consultório de Terapia Corporal Sistêmica</p>
  </footer>

  <script>
    let sessoes = [];
    const moedaBRFormatter = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });

    function textoPagamento(sessao) {
      if (sessao && sessao.usou_pacote) {
        return 'Pagamento: Pacote de sessões';
      }
      if (
        sessao &&
        typeof sessao.preco_final === 'number' &&
        Number.isFinite(sessao.preco_final)
      ) {
        return `Valor: ${moedaBRFormatter.format(sessao.preco_final)}`;
      }
      return '';
    }

    function resumoAnamnese(sessao) {
      if (!sessao || !sessao.anamnese) return '';
      if (typeof sessao.anamnese === 'string') {
        return sessao.anamnese;
      }
      if (typeof sessao.anamnese === 'object') {
        if (sessao.anamnese.geral) return sessao.anamnese.geral;
        if (sessao.anamnese.orientacoes) return sessao.anamnese.orientacoes;
        try {
          return JSON.stringify(sessao.anamnese);
        } catch (e) {
          return '';
        }
      }
      return '';
    }
        
    function nomeTratamentos(sessao) {
      if (Array.isArray(sessao.tratamentos) && sessao.tratamentos.length) {
        return sessao.tratamentos.join(' + ');
      }
      return sessao.tratamento;
    }
    const TEXTO_ANAMNESE_DISPONIVEL = 'Anamnese/Orientação disponível';
    const TEXTO_ANAMNESE_INDISPONIVEL = 'Anamnese/Orientação indisponível';

    let usuario = {};
    let exigirDadosObrigatorios = false;

    function abrirModalPerfil(obrigatorio = false) {
      const modal = document.getElementById('modal-editar');
      if (!modal) return;

      document.getElementById('editar-nome').value = usuario.nome || "";
      document.getElementById('editar-email').value = usuario.email || "";
      document.getElementById('editar-nascimento').value = usuario.nascimento || "";
      document.getElementById('editar-telefone').value = usuario.telefone || "";
      document.getElementById('editar-sexo').value = usuario.sexo || "";

      modal.style.display = 'flex';
      modal.dataset.obrigatorio = obrigatorio ? '1' : '0';

      const cancelarBtn = document.getElementById('btn-cancelar-editar');
      if (cancelarBtn) {
        cancelarBtn.style.display = obrigatorio ? 'none' : 'inline-block';
      }

      const tituloModal = modal.querySelector('h3');
      if (tituloModal) {
        tituloModal.textContent = obrigatorio ? 'Complete seu perfil' : 'Editar Perfil';
      }
    }

    // Preenche dados usuário
      fetch("getPerfil.php", { credentials: 'include' })
      .then(res => res.ok ? res.json() : Promise.reject())
      .then(data => {
        const perfilLoginEl = document.getElementById('li-perfil-login');
        if (perfilLoginEl) {
          if (data.usuario && data.usuario.nome) {
            if (data.usuario.tipo === 'terapeuta' || data.usuario.is_admin == 1) {
              perfilLoginEl.innerHTML = '<a href="admin/index.php"><i class="fa-solid fa-lock"></i> Painel Adm.</a>';
            } else {
              perfilLoginEl.innerHTML = '<a href="perfil.html"><i class="fa-solid fa-user"></i> Perfil</a>';
            }
          } else {
            perfilLoginEl.innerHTML = '<a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a>';
          }
        }
        usuario = data.usuario || {};

        const alertaCompletar = document.getElementById('alerta-completar');
        const params = new URLSearchParams(window.location.search);
        const telefoneValido = usuario.telefone && String(usuario.telefone).trim() !== '';
        if (!telefoneValido) {
          usuario.telefone = '';
        }
        const sexoValido = usuario.sexo && String(usuario.sexo).trim() !== '';
        if (!sexoValido) {
          usuario.sexo = '';
        }
        const nascimentoValido = usuario.nascimento && usuario.nascimento !== '0000-00-00';
        if (!nascimentoValido) {
          usuario.nascimento = '';
        }
        const camposObrigatoriosVazios = !telefoneValido || !nascimentoValido || !sexoValido;
        exigirDadosObrigatorios = Boolean(usuario && (usuario.id || usuario.email)) && (camposObrigatoriosVazios || params.get('completar') === '1');

        if (exigirDadosObrigatorios) {
          if (alertaCompletar) {
            alertaCompletar.style.display = 'block';
          }
          abrirModalPerfil(true);
        } else if (alertaCompletar) {
          alertaCompletar.style.display = 'none';
        }

        document.querySelector("#perfil-nome").textContent = usuario.nome || "";
        document.querySelector("#perfil-email").textContent = usuario.email || "";
        document.querySelector(".perfil-avatar").src = usuario.foto || "img/avatar-user.jpg";
        if (usuario.nascimento) {
          const nascimento = new Date(usuario.nascimento);
          const hoje = new Date();
          let idade = hoje.getFullYear() - nascimento.getFullYear();
          if (
            hoje.getMonth() < nascimento.getMonth() ||
            (hoje.getMonth() === nascimento.getMonth() && hoje.getDate() < nascimento.getDate())
          ) {
            idade--;
          }
          document.getElementById("perfil-idade").textContent = idade + " anos";
        } else {
          document.getElementById("perfil-idade").textContent = "--";
        }

        const pacote = data.pacote;
        if (pacote && pacote.total > 0) {
          document.getElementById('pacote-info').innerHTML =
            `Você possui <b>${pacote.disponiveis}</b> de ${pacote.total} sessões do pacote disponíveis.`;
        } else {
          document.getElementById('pacote-info').innerHTML =
            `Você não possui pacotes ativos. <a href="pacotes.php" style="color:#b48c1a;text-decoration:underline;">Clique aqui para comprar um pacote.</a>`;
        }

        sessoes = data.sessoes || [];
        renderProximasSessoes(sessoes);
        renderHistoricoSessoes(sessoes);
      })
      .catch(err => {
        console.error("Erro ao carregar perfil:", err);
        const perfilLoginEl = document.getElementById('li-perfil-login');
        if (perfilLoginEl) {
          perfilLoginEl.innerHTML = '<a href="registrar.html"><i class="fa-solid fa-user"></i> Login</a>';
        }
      });

    function obterDataSessao(sessao) {
      if (!sessao) return null;
      const valor = sessao.data_horario || sessao.data || sessao.data_inicio;
      if (!valor) return null;
      if (valor instanceof Date) {
        return Number.isNaN(valor.getTime()) ? null : valor;
      }
      const normalizado = typeof valor === 'string' ? valor.replace(' ', 'T') : valor;
      const data = new Date(normalizado);
      return Number.isNaN(data.getTime()) ? null : data;
    }

    function formatarDataSessao(data) {
      if (!(data instanceof Date) || Number.isNaN(data.getTime())) return '';
      return data.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function montarSessaoCard(sessao, opcoes = {}) {
      const { exibirAnamnese = true } = opcoes;
      const dataSessao = obterDataSessao(sessao);
      const tituloTratamento = nomeTratamentos(sessao);
      const tituloTratamentoHtml = tituloTratamento ? escapeHtml(tituloTratamento) : '';
      const pagamentoLinha = textoPagamento(sessao);
      const pagamentoHtml = pagamentoLinha ? `<div class="sessao-pagamento">${escapeHtml(pagamentoLinha)}</div>` : '';
      const reclamacaoSintomas = sessao && sessao.reclamacao && sessao.reclamacao.sintomas
        ? escapeHtml(sessao.reclamacao.sintomas)
        : '';
      const reclamacaoIntensidade = sessao && sessao.reclamacao && sessao.reclamacao.intensidade
        ? ` (${escapeHtml(sessao.reclamacao.intensidade)})`
        : '';
      const reclamacao = reclamacaoSintomas
        ? `<div class="sessao-queixa">Queixa: ${reclamacaoSintomas}${reclamacaoIntensidade}</div>`
        : '';
      const statusTexto = sessao && sessao.status ? String(sessao.status) : '';
      const statusHtml = statusTexto
        ? `<span class="sessao-status ${statusClass(statusTexto)}">${escapeHtml(statusTexto)}</span>`
        : '';
      const dataHtml = dataSessao
        ? `<div class="sessao-data">${formatarDataSessao(dataSessao)}${sessao && sessao.duracao ? ` - ${sessao.duracao} min` : ''}</div>`
        : '';
      let anamneseHtml = '';
      if (exibirAnamnese) {
        const temAnamnese = Boolean(sessao && sessao.anamnese);
        const temAtualizacaoNaoLida = Boolean(sessao && sessao.temNotificacao);
        const badgeHtml = temAnamnese && temAtualizacaoNaoLida
          ? '<span class="anamnese-badge" aria-hidden="true"></span>'
          : '';
        const pill = temAnamnese
          ? `<button type="button" class="anamnese-pill disponivel" onclick="event.stopPropagation(); abrirModalAnamnese(${sessao.id})">${badgeHtml}<span>${TEXTO_ANAMNESE_DISPONIVEL}</span></button>`
          : `<span class="anamnese-pill indisponivel">${TEXTO_ANAMNESE_INDISPONIVEL}</span>`;
        anamneseHtml = [
          '    <div class="sessao-anamnese">',
          `      ${pill}`,
          '    </div>'
        ].join('\n');
      }

      return [
        `<div class="sessao-card" onclick="abrirSessao(${sessao.id})">`,
        '  <div class="sessao-info">',
        `    <div class="sessao-tratamento">${tituloTratamentoHtml}</div>`,
        dataHtml ? `    ${dataHtml}` : '',
        pagamentoHtml ? `    ${pagamentoHtml}` : '',
        reclamacao ? `    ${reclamacao}` : '',
        statusHtml ? `    ${statusHtml}` : '',
        anamneseHtml,
        '  </div>',
        '</div>'
      ].filter(Boolean).join('\n');
    }

    function renderProximasSessoes(listaSessoes = sessoes) {
      const lista = document.getElementById('proximas-sessoes');
      if (!lista) return;

      const agora = new Date();
      const futuras = (listaSessoes || [])
        .map(sessao => ({ sessao, data: obterDataSessao(sessao) }))
        .filter(item => {
          if (!item.data || item.data <= agora) return false;
          const status = (item.sessao.status || '').toLowerCase();
          return status !== 'cancelada' && status !== 'concluída' && status !== 'concluida';
        })
        .sort((a, b) => a.data - b.data)
        .map(item => item.sessao);

      if (!futuras.length) {
        lista.innerHTML = `
          <p>Nenhuma sessão agendada.<br>
          <a href="agendamento.php" style="color:#b48c1a;text-decoration:underline;cursor:pointer;">Clique aqui para agendar uma consulta.</a>
          </p>
        `;
        return;
      }

      const cardsSemAnamnese = futuras
        .map(sessao => montarSessaoCard(sessao, { exibirAnamnese: false }));

      lista.innerHTML = cardsSemAnamnese.join('');
    }

    function renderHistoricoSessoes(listaSessoes = sessoes) {
      const lista = document.getElementById('historico-sessoes');
      if (!lista) return;

      const agora = new Date();
      const passadas = (listaSessoes || [])
        .map(sessao => ({ sessao, data: obterDataSessao(sessao) }))
        .filter(item => {
          if (!item.data) return false;
          if (item.data <= agora) return true;
          const status = (item.sessao.status || '').toLowerCase();
          return status === 'cancelada' || status === 'concluída' || status === 'concluida' || status === 'realizada';
        })
        .sort((a, b) => b.data - a.data)
        .map(item => item.sessao);

      if (!passadas.length) {
        lista.innerHTML = '<div class="nenhuma-sessao">Nenhuma sessão anterior encontrada.</div>';
        return;
      }

      const cards = passadas.map(sessao => {
        const atualizadoEm = sessao && sessao.anamnese_atualizada_em
          ? String(sessao.anamnese_atualizada_em)
          : null;
        const visualizadoEm = lerTimestampAnamneseVisualizada(sessao && sessao.id);
        const temAtualizacaoNaoLida = Boolean(
          sessao &&
          sessao.anamnese &&
          atualizadoEm &&
          visualizadoEm !== atualizadoEm
        );
        sessao.temNotificacao = temAtualizacaoNaoLida;
        return montarSessaoCard(sessao);
      });

      lista.innerHTML = cards.join('');
    }

    function statusClass(status) {
      const mapa = {
        'pendente': 'status-pendente',
        'confirmada': 'status-confirmada',
        'concluída': 'status-confirmada',
        'concluida': 'status-confirmada',
        'realizada': 'status-confirmada',
        'cancelada': 'status-cancelada'
      };
      if (!status) return '';
      const chave = String(status).toLowerCase();
      return mapa[chave] || '';
    }

    function escapeHtml(texto = '') {
      return String(texto)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function obterChaveAnamneseVisualizada(id) {
      return `anamnese_visualizada_${id}`;
    }

    function obterLocalStorageSeguro() {
      if (typeof window === 'undefined' || typeof window.localStorage === 'undefined') {
        return null;
      }
      try {
        return window.localStorage;
      } catch (erro) {
        console.warn('LocalStorage indisponível:', erro);
        return null;
      }
    }

    function lerTimestampAnamneseVisualizada(idSessao) {
      const storage = obterLocalStorageSeguro();
      if (!storage || !idSessao) return null;
      try {
        const valor = storage.getItem(obterChaveAnamneseVisualizada(idSessao));
        return valor && valor !== 'undefined' ? valor : null;
      } catch (erro) {
        console.warn('Não foi possível ler a versão da anamnese:', erro);
        return null;
      }
    }

    function salvarTimestampAnamneseVisualizada(idSessao, timestamp) {
      const storage = obterLocalStorageSeguro();
      if (!storage || !idSessao) return;
      try {
        if (timestamp) {
          storage.setItem(obterChaveAnamneseVisualizada(idSessao), String(timestamp));
        } else {
          storage.removeItem(obterChaveAnamneseVisualizada(idSessao));
        }
      } catch (erro) {
        console.warn('Não foi possível salvar a versão da anamnese:', erro);
      }
    }

    function registrarAnamneseVisualizada(sessao) {
      if (!sessao || !sessao.id || !sessao.anamnese) {
        return false;
      }

      const timestampAtual = sessao.anamnese_atualizada_em
        ? String(sessao.anamnese_atualizada_em)
        : new Date().toISOString();

      salvarTimestampAnamneseVisualizada(sessao.id, timestampAtual);
      sessao.temNotificacao = false;
      return true;
    }

    function abrirModalAnamnese(id) {
      const modal = document.getElementById('modal-anamnese');
      const tituloEl = document.getElementById('modal-anamnese-titulo');
      const conteudoEl = document.getElementById('modal-anamnese-conteudo');
      if (!modal || !conteudoEl) return;

      const sessao = (sessoes || []).find(sessao => String(sessao.id) === String(id));
      if (sessao) {
        const tituloTrat = nomeTratamentos(sessao) || sessao.tratamento || 'Sessão';
        tituloEl.textContent = `Anamnese - ${tituloTrat}`;
      } else {
        tituloEl.textContent = 'Anamnese da sessão';
      }

      conteudoEl.innerHTML = gerarConteudoAnamnese(sessao);

      if (sessao && sessao.anamnese) {
        const marcouComoLida = registrarAnamneseVisualizada(sessao);
        if (marcouComoLida) {
          renderHistoricoSessoes(sessoes);
        }
      } else {
        fecharModalAnamnese();
        return;
      }

      modal.classList.add('aberto');
      document.body.dataset.modalAnamneseAberto = '1';
      document.body.style.overflow = 'hidden';
    }

    function fecharModalAnamnese() {
      const modal = document.getElementById('modal-anamnese');
      if (!modal) return;
      modal.classList.remove('aberto');
      delete document.body.dataset.modalAnamneseAberto;
      document.body.style.overflow = '';
    }

    function gerarConteudoAnamnese(sessao) {
      if (!sessao || !sessao.anamnese) {
        return '<p class="modal-anamnese-empty">Anamnese indisponível para esta sessão.</p>';
      }

      const anamnese = sessao.anamnese;
      if (typeof anamnese === 'string') {
        const texto = resumoAnamnese(sessao);
        if (!texto) {
          return '<p class="modal-anamnese-empty">Anamnese indisponível para esta sessão.</p>';
        }
        return `<p>${escapeHtml(texto).replace(/\n/g, '<br>')}</p>`;
      }

      if (typeof anamnese === 'object') {
        const partes = [];
        Object.entries(anamnese).forEach(([chave, valor]) => {
          if (valor === null || valor === undefined || valor === '') return;
          if (typeof valor === 'object') {
            try {
              const jsonTexto = JSON.stringify(valor, null, 2);
              partes.push(`<div class="campo-anamnese"><strong>${escapeHtml(chave)}</strong><pre>${escapeHtml(jsonTexto)}</pre></div>`);
            } catch (e) {
              partes.push(`<div class="campo-anamnese"><strong>${escapeHtml(chave)}</strong><span>${escapeHtml(String(valor))}</span></div>`);
            }
            return;
          }
          partes.push(`<div class="campo-anamnese"><strong>${escapeHtml(chave)}</strong><span>${escapeHtml(String(valor)).replace(/\n/g, '<br>')}</span></div>`);
        });

        if (!partes.length) {
          const texto = resumoAnamnese(sessao);
          if (texto) {
            partes.push(`<p>${escapeHtml(texto).replace(/\n/g, '<br>')}</p>`);
          }
        }

        if (!partes.length) {
          try {
            const texto = JSON.stringify(anamnese, null, 2);
            return `<pre>${escapeHtml(texto)}</pre>`;
          } catch (e) {
            return '<p class="modal-anamnese-empty">Informações indisponíveis.</p>';
          }
        }

        return partes.join('');
      }

      const texto = resumoAnamnese(sessao);
      return texto
        ? `<p>${escapeHtml(texto).replace(/\n/g, '<br>')}</p>`
        : '<p class="modal-anamnese-empty">Anamnese indisponível para esta sessão.</p>';
    }

    // Mostra detalhes da sessão selecionada (SPA)
    function abrirSessao(id) {
      const s = sessoes.find(sessao => sessao.id === id);
      document.getElementById('perfil-area').style.display = 'none';
      document.getElementById('detalhe-sessao').style.display = 'block';
      document.getElementById('detalhe-titulo').innerText = `Detalhes da Sessão - ${s.tratamento}`;
      // Formulário de queixas (se houver)
      if (s.reclamacao) {
        document.getElementById('detalhe-formulario').innerHTML = `
          <label>Formulário de Queixas:</label>
          <div class="valor"><b>Sintomas:</b> ${s.reclamacao.sintomas}</div>
          <div class="valor"><b>Tempo de sintomas:</b> ${s.reclamacao.tempo}</div>
          <div class="valor"><b>Intensidade:</b> ${s.reclamacao.intensidade}</div>
          <div class="valor"><b>Tratamento já realizado:</b> ${s.reclamacao.tratamento}</div>
        `;
      } else {
        document.getElementById('detalhe-formulario').innerHTML = `<label>Formulário de Queixas:</label><div class="valor">Não preenchido.</div>`;
      }
      // Anamnese (se houver)
      if (s.anamnese) {
        if (typeof s.anamnese === 'string') {
          const texto = s.anamnese.replace(/\n/g, '<br>');
          document.getElementById('detalhe-anamnese').innerHTML = `
            <label>Anamnese da Sessão:</label>
            <div class="valor">${texto}</div>
          `;
        } else if (typeof s.anamnese === 'object') {
          const partes = [];
          if (s.anamnese.geral) {
            partes.push(`<div class="valor"><b>Resumo:</b> ${s.anamnese.geral}</div>`);
          }
          if (s.anamnese.orientacoes) {
            partes.push(`<div class="valor"><b>Orientações:</b> ${s.anamnese.orientacoes}</div>`);
          }
          if (!partes.length) {
            try {
              partes.push(`<div class="valor">${JSON.stringify(s.anamnese)}</div>`);
            } catch (e) {
              partes.push(`<div class="valor">Informações indisponíveis.</div>`);
            }
          }
          document.getElementById('detalhe-anamnese').innerHTML = `
            <label>Anamnese da Sessão:</label>
            ${partes.join('')}
          `;
        } else {
          document.getElementById('detalhe-anamnese').innerHTML = `
            <label>Anamnese da Sessão:</label>
            <div class="valor">${String(s.anamnese)}</div>
          `;
        }
        const marcouComoLida = registrarAnamneseVisualizada(s);
        if (marcouComoLida) {
          renderHistoricoSessoes(sessoes);
        }
      } else {
        document.getElementById('detalhe-anamnese').innerHTML = `<label>Anamnese da Sessão:</label><div class="valor">Ainda não disponível.</div>`;
      }
    }

    // Retorna do detalhe ao perfil principal
    function voltarParaPerfil() {
      document.getElementById('detalhe-sessao').style.display = 'none';
      document.getElementById('perfil-area').style.display = 'block';
      renderProximasSessoes(sessoes);
      renderHistoricoSessoes(sessoes);
    }

        // Menu responsivo sanduíche
    const navbarToggle = document.querySelector('.navbar-toggle');
    const navbarMenu = document.querySelector('.navbar-menu');
    navbarToggle.addEventListener('click', () => {
      navbarMenu.classList.toggle('open');
    });
    // Fechar menu ao clicar em um item
    document.querySelectorAll('.navbar-menu a').forEach(link => {
      link.addEventListener('click', () => {
        navbarMenu.classList.remove('open');
      });
    });

    function uploadFotoPerfil(input) {
      const file = input.files[0];
      if (!file) return;

      // Mostra preview imediato
      const reader = new FileReader();
      reader.onload = function (e) {
        document.querySelector('.perfil-avatar').src = e.target.result;
      };
      reader.readAsDataURL(file);

      // Redimensiona e envia para backend
      const img = new Image();
      img.onload = function () {
        const canvas = document.createElement('canvas');
        const max = 320;
        let w = img.width, h = img.height;
        if (w > h && w > max) { h *= max / w; w = max; }
        else if (h > w && h > max) { w *= max / h; h = max; }
        canvas.width = w; canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
        canvas.toBlob(blob => {
          const formData = new FormData();
          formData.append('foto', blob, file.name);
          fetch('uploadFoto.php', { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
              if (data.sucesso) {
                document.querySelector('.perfil-avatar').src = data.foto + '?v=' + Date.now();
                showFeedback('Foto de perfil atualizada com sucesso!');
              } else {
                showFeedback('Erro ao enviar a foto', true);
              }
            });
        }, 'image/jpeg', 0.84);
      };
      img.src = URL.createObjectURL(file);
    }


    // Eventos
    document.getElementById('upload-foto').addEventListener('change', function() { uploadFotoPerfil(this); });
    document.getElementById('upload-foto-camera').addEventListener('change', function() { uploadFotoPerfil(this); });

    const modalAnamnese = document.getElementById('modal-anamnese');
    if (modalAnamnese) {
      modalAnamnese.addEventListener('click', (event) => {
        if (event.target === modalAnamnese) {
          fecharModalAnamnese();
        }
      });
    }

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && document.body.dataset.modalAnamneseAberto === '1') {
        fecharModalAnamnese();
      }
    });


    const botaoEditar = document.querySelector('.perfil-editar');
    if (botaoEditar) {
      botaoEditar.addEventListener('click', () => {
        abrirModalPerfil(exigirDadosObrigatorios);
      });
    }


    // Para fechar o modal
    function fecharModal(force = false) {
      const modal = document.getElementById('modal-editar');
      if (!modal) return;

      if (!force && modal.dataset.obrigatorio === '1') {
        showFeedback('Complete seu perfil para continuar.', true);
        return;
      }

      modal.style.display = 'none';
      modal.dataset.obrigatorio = '0';
    }


    function salvarEdicao() {
      const nome = document.getElementById('editar-nome').value;
      const email = document.getElementById('editar-email').value;
      const telefone = document.getElementById('editar-telefone').value.trim();
      const nascimento = document.getElementById('editar-nascimento').value;
      const sexo = document.getElementById('editar-sexo').value;

      const modal = document.getElementById('modal-editar');
      const obrigatorio = modal && modal.dataset.obrigatorio === '1';

      if ((obrigatorio || exigirDadosObrigatorios) && (!telefone || !nascimento || !sexo)) {
        showFeedback('Informe telefone, data de nascimento e sexo para continuar.', true);
        return;
      }

      const formData = new FormData();
      formData.append('nome', nome);
      formData.append('email', email);
      formData.append('telefone', telefone);
      formData.append('nascimento', nascimento);
      formData.append('sexo', sexo);

      fetch('atualizarPerfil.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.sucesso) {
          exigirDadosObrigatorios = false;
          if (modal) {
            modal.dataset.obrigatorio = '0';
          }
          const alertaCompletar = document.getElementById('alerta-completar');
          if (alertaCompletar) {
            alertaCompletar.style.display = 'none';
          }
          fecharModal(true);
          // Atualiza imediatamente os campos visuais
          document.getElementById("perfil-nome").textContent = nome;
          document.getElementById("perfil-email").textContent = email;

          // Atualiza idade
          if (nascimento) {
            const nascimentoDate = new Date(nascimento);
            const hoje = new Date();
            let idade = hoje.getFullYear() - nascimentoDate.getFullYear();
            if (
              hoje.getMonth() < nascimentoDate.getMonth() ||
              (hoje.getMonth() === nascimentoDate.getMonth() && hoje.getDate() < nascimentoDate.getDate())
            ) {
              idade--;
            }
            document.getElementById("perfil-idade").textContent = idade + " anos";
          } else {
            document.getElementById("perfil-idade").textContent = "--";
          }

          // Atualiza o objeto usuario (sincroniza sexo etc.)
          usuario.nome = nome;
          usuario.email = email;
          usuario.telefone = telefone;
          usuario.nascimento = nascimento;
          usuario.sexo = sexo;

          if (window.history.replaceState) {
            const novaUrl = window.location.pathname;
            window.history.replaceState(null, '', novaUrl);
          }

          showFeedback("Dados salvos com sucesso!");
        } else {
          showFeedback("Erro ao salvar!", true);
        }
      });
    }

    function showFeedback(msg, erro = false) {
      let el = document.getElementById('feedback-msg');
      if (!el) {
        el = document.createElement('div');
        el.id = 'feedback-msg';
        el.style.cssText = 'display:none;position:fixed;top:15px;left:50%;transform:translateX(-50%);background:#3b9855;padding:14px 32px;font-size:1.1rem;color:#fff;border-radius:8px;z-index:99999;box-shadow:0 3px 20px #2225;';
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.background = erro ? '#c33' : '#3b9855';
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 2100);
    }
    function logout() {
      fetch("logout.php")
        .then(() => window.location.href = "registrar.html");
    }
    // Mostra pacote de sessões
// Mostra pacote de sessões do usuário (consultando no backend)
fetch('getPacoteUsuario.php')
  .then(res => res.json())
  .then(data => {
    document.getElementById('pacote-info').innerHTML = 
      data.sessoes_restantes > 0
        ? `<b>Você tem ${data.sessoes_restantes} sessão(ões) de pacote disponível(is).</b>`
        : `Você não possui sessões de pacote disponíveis. <a href="pacotes.php" style="color:#b79b63;text-decoration:underline;">Adquira um pacote!</a>`;
  });

  </script>

</body>
</html>
